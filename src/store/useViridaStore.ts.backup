import { create } from 'zustand';
import { mockSensors, mockZones, mockAutomationRules, SensorData, Zone, AutomationRule } from '../data/mockData';

export interface SensorData {
  id: string;
  type: string;
  value: number;
  unit: string;
  status: 'normal' | 'warning' | 'alert';
  timestamp: Date;
  history: Array<{
    value: number;
    timestamp: Date;
  }>;
}

interface Zone {
  id: string;
  name: string;
}

interface AutomationRule {
  id: string;
  enabled: boolean;
}

export interface Plant {
  id: string;
  name: string;
  species: string;
  category: string;
  difficulty: string;
  health: number;
  growthStage: string;
  daysToHarvest?: number;
  imageUrl?: string;
  iconEmoji?: string;
}

interface ViridaStore {
  sensors: SensorData[];
  zones: Zone[];
  automationRules: AutomationRule[];
  plants: Plant[];
  selectedZone: string | null;
  apiUrl: string;
  setSelectedZone: (zoneId: string | null) => void;
  configApiUrl: (url: string) => void;
  setPlants: (plants: Plant[]) => void;
  updateSensorValue: (sensorId: string, value: number) => void;
  toggleAutomationRule: (ruleId: string) => void;
}

export const useViridaStore = create<ViridaStore>((set) => ({
  sensors: mockSensors,
  zones: mockZones,
  automationRules: mockAutomationRules,
  plants: [],
  selectedZone: null,
  apiUrl: import.meta.env.VITE_API_URL || 'http://localhost:3000',
  setSelectedZone: (zoneId) => set({ selectedZone: zoneId }),
  configApiUrl: (url) => set({ apiUrl: url }),
  setPlants: (plants) => set({ plants }),
  updateSensorValue: (sensorId, value) =>
    set((state) => ({
      sensors: state.sensors.map((sensor) =>
        sensor.id === sensorId ? { ...sensor, value } : sensor
      ),
    })),
  toggleAutomationRule: (ruleId) =>
    set((state) => ({
      automationRules: state.automationRules.map((rule) =>
        rule.id === ruleId ? { ...rule, enabled: !rule.enabled } : rule
      ),
    })),
}));
